# Oracle GoldenGate 介绍

　　GoldenGate软件是一种基于日志的结构化数据复制软件。GoldenGate 能够实现大量交易数据的实时捕捉、变换和投递，实现源数据库与目标数据库的数据同步，保持亚秒级的数据延迟。

　　简言之：**Oracle GoldenGate软件是做Oracle数据库双活复制的**。

## **原理**

　　通过解析源数据库redo log 或者archive log获得数据的增量变化，然后通过TCP/IP投递到目标数据库，最后将这些变化解析还原应用到目标数据库，从而实现两边同步。DSG复制工具也是基于相似原理。

​![13885a6b152e4cbaa6f308d542c50618~tplv-k3u1fbpfcp-zoom-in-crop-mark 1512 0 0 0](assets/13885a6b152e4cbaa6f308d542c50618tplv-k3u1fbpfcp-zoom-in-crop-mark%201512%200%200%200-20240315212745-ejqau90.webp)​

　　**执行步骤**

1. 通过抽取进程(Extract Process)和复制进程(replicat process)进行初始化数据同步
2. 抽取进程(Extract Process)在源端数据库中读取online redo log或者archive redo log，然后进行解析，只提取其中数据的变化信息，比如DML操作
3. 将抽取的信息转换为OGG自定义的中间格式存放在队列文件(trail file)中
4. 通过传输进程将队列文件(trail file)通过TCP/IP传送到目标端，可配置投递进程（Pump Process）将trail file文件以数据块的形式传送到目标端
5. 目标端Server Collector进程接收从源端传输过来的数据变化信息，把信息缓存到队列文件trail file中
6. 目标端复制进程(replicat process)从trail file中读取数据变化信息，并创建对应的SQL语句，应用到目标数据库，提交成功后更新自己的检查点，记录已经完成复制的位置，完成数据复制

　　‍

　　‍

## **应用场景**

　　1)高可用容灾

　　2)数据库迁移、升级（支持跨版本、异构数据库、零宕机时间、亚秒级恢复）

　　3)实时数据集成（支持异构数据库、多源数据库）

　　‍

## DG 和 OGG 总结

　　Oracle DataGuard  VS  Oracle GoldenGate

||DG|OGG|
| ----------------| --------------------------------------------------------------------------| ------------------------------------------------------------------------------------------------------------------------------------|
|原理|将redo log从源数据库传输到目标数据库，然后在目标数据库上应用这些日志文件|通过解析源数据库redo log 或者archive log获得数据的增量变化，然后通过TCP/IP投递到目标数据库，最后将这些变化解析还原应用到目标数据库|
|稳定性|作为灾备的稳定性极高|由于数据复制操作独立于数据库管理系统，因此不能确保数据零丢失|
|维护|维护简单，极少出现问题|命令行方式，维护较复杂|
|对象支持|完全支持|部分对象需手工创建与维护|
|目标端可用性|目标端处于恢复或只读状态|两端数据库是活动的，目标端可以提供实时的数据查询，也可以实现两端数据的同时写入|
|复制方式|可以实现实时复制|GoldenGate可以提供秒一级的大量数据实时捕捉和投递，异步复制方式，无法实现同步复制|
|资源占用|复制通过数据库的LGWR进程或ARCN进程完成，占用数据库少量资源|业务高峰时在数据抽取转换时消耗系统资源较多，低峰时占用较小|
|异构数据库支持|仅运行在Oracle数据库上，且源端和目标端操作系统要求较严格|可以在不同类型和版本的数据库之间进行数据复制，也适用于不同操作系统间同步|

　　DataGuard是实现Oracle数据库灾备的比较好的方式，我们的项目中也尝试使用OGG做灾备，主要遇到下面的问题：

* 1、两端数据库数据一致性的保障
  DataGuard可以实现实时复制，且由数据库本身机制保证它的一致性。而OGG的数据复制操作独立于数据库管理系统，只能保证它抽取的变化数据都应用到目标端，但却不能确保两端数据库一定是一致的。虽然OGG目前在DML复制上很少出现问题，但我们还是写了许多额外的稽核脚本来确保两端数据一致。通过稽核，也发现确实会出现OGG本身未报错，但表数据不一致的情况。

* 2、对象的维护
  部分对象需手工创建与维护，为了保证对象一致，还需要额外写脚本进行数据库对象稽核。

* 3、效率问题
  如果在源端的表未建索引，且进行了大量的增删改操作时，会极大影响OGG的复制进程效率。如我们某个表没有建索引，批量更新删除48万数据，复制进程延迟了6个小时，才在目标端应用了15万的数据，最终跑了19个小时才将OGG追平。同理如果在源端trancate，也会导致大量数据变化，从而影响OGG效率。

　　总的来说，如果两端都是ORACLE，且操作系统相同，DataGuard是较好的方式。而如果要实现异构数据库间的数据同步，或者两端的操作系统不同，则只能选择OGG的方式。使用该种方式则需要在数据一致性保障、效率提升方面花更多功夫。

　　‍
