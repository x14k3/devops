计算机存储中的 **多路径（MultiPathing）** 是一种**提高存储系统可靠性和性能的技术**。它的核心思想是为服务器（主机）与存储设备（如磁盘阵列、SAN存储）之间提供**多条物理或逻辑路径**。当一条路径出现故障时，系统可以自动切换到其他可用路径，确保存储访问不中断，同时还能通过多条路径并行传输数据以提升性能。

[[../linux/linux 文件系统/9. linux Multipath|9. linux Multipath]]
### 核心目的与优势

1. **高可用性：**
    
    - **故障切换：** 这是最主要的目的。如果某条路径上的组件（如HBA卡、光纤线、交换机端口、存储控制器端口）发生故障，多路径软件会自动将I/O流量切换到其他健康的路径上。用户和应用程序通常感知不到中断。
    - **避免单点故障：** 通过消除路径上的单点故障，极大地提高了存储访问的持续可用性。
        
2. **负载均衡：**
    
    - **性能提升：** 多路径软件可以将I/O请求智能地分发到多条可用路径上，充分利用所有路径的带宽，避免单条路径成为瓶颈，从而提升整体I/O吞吐量和性能。
    - **优化资源利用：** 均衡地利用服务器端的HBA卡、网络交换机端口和存储控制器端口等资源。
        
3. **路径优化：**
    
    - 多路径软件通常会监控各条路径的状态（延迟、错误率等），并优先选择最优路径发送I/O请求。
        

### 实现原理

1. **物理冗余：**
    
    - 服务器配备**多个主机总线适配器**。
    - 使用**冗余的光纤交换机**。
    - 存储设备配备**多个前端控制器端口**。
    - 使用**冗余的光纤线缆**连接以上组件。
    - 这样，从服务器到存储设备上的同一个LUN（逻辑单元号，即存储卷）之间，就形成了多条物理独立的访问路径。
        
2. **多路径软件：**
    
    - 这是实现多路径功能的核心。操作系统需要安装特定的多路径软件。
        
    - **常见方案：**
        - **操作系统原生：** 如Linux的`Device Mapper Multipath`、Windows Server的`MPIO`。
        - **存储厂商提供：** 如EMC PowerPath、Dell PowerPath、HPE Path Management Advisor、IBM SDD/MPP等（通常提供更高级功能，但可能有许可费用）。
            
    - **关键作用：**
        
        - **路径发现与管理：** 识别所有通向同一存储设备的物理路径。
        - **设备虚拟化：** 将多条物理路径背后的同一个物理LUN，抽象、聚合成一个**虚拟设备**呈现给操作系统和应用。应用只看到这个单一的、更可靠的虚拟设备。
        - **路径监控：** 持续检查各路径的健康状态。
        - **故障切换：** 在检测到路径故障时，自动将I/O切换到备用路径。
        - **负载均衡：** 根据配置的策略（如轮询、最少队列深度、服务时间等）将I/O分发到不同路径。
        - **路径恢复：** 当故障路径恢复后，将其重新纳入可用路径池。

### 应用场景

- **关键业务应用：** 数据库服务器、邮件服务器、虚拟化平台（如VMware ESXi, Microsoft Hyper-V）、ERP系统等对高可用性要求极高的场景。
- **大型企业数据中心：** 普遍采用SAN存储架构的环境。
- **任何需要消除存储访问单点故障的环境。**

### 关键概念

- **LUN：** 存储设备上划分出来的逻辑存储单元，是服务器识别和访问的基本磁盘单位。
- **HBA：** 主机总线适配器，服务器上连接存储网络的接口卡（如FC HBA、iSCSI HBA）。
- **路径：** 指从服务器操作系统通过特定HBA、特定交换机端口、特定存储控制器端口到达特定LUN的一条完整I/O通道。
- **虚拟设备：** 多路径软件聚合多条物理路径后呈现给操作系统的单一设备标识符（例如在Linux中是`/dev/mapper/mpathX`，在Windows中是`MPIO Disk`）。

### 总结

存储多路径是一种通过创建冗余路径并使用智能软件管理这些路径，来**实现存储访问高可用性、提升性能和避免单点故障**的关键技术。它是构建可靠、高性能的企业级存储架构的基石之一。没有多路径，任何一条路径上的故障都可能导致服务器无法访问其存储，造成服务中断。

简单来说，多路径就是给服务器访问存储的“路”修了多条“备用车道”和“立交桥”，确保即使一条路堵了或断了，车流（数据）仍然能顺畅通行，甚至还能通过多条路同时跑车来提高整体运输效率。