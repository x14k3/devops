# 卷影副本 Shadow Copy 

卷影复制（也称为卷快照服务、卷影复制服务或 VSS）是 Microsoft Windows  中内置的一项技术，可让您在计算机文件或卷使用时创建备份副本或快照。它作为一项称为卷影复制服务的 Windows 服务实现。软件 VSS  提供程序服务也包含在 Windows 中，供 Windows 应用程序使用。卷影副本技术需要 Windows NTFS 或 ReFS  文件系统来创建和存储卷影副本。使用此技术的 Windows 组件可以在本地和外部（可移动或网络）卷上创建卷影副本，例如在创建计划的  Windows 备份或自动系统还原点时。

## 概述

VSS 在卷的块级别工作。 快照是卷的只读时间点副本。快照允许您创建卷的一致备份，确保在创建备份时其内容不会被修改或锁定。 卷影复制的核心组件是卷影复制服务，它启动并监控快照创建过程。执行所有必要的数据传输的组件称为提供者。 Windows  附带了默认的系统提供程序，但软件和硬件供应商可以创建自己的软件或硬件提供程序，并将其注册到卷影复制服务。每个提供程序最多需要 10  秒才能完成快照生成。快照创建过程中涉及的另一个组件是写入器。卷影副本的目的是创建一致且可靠的快照。然而，这可能无法通过简单地完成所有挂起的文件修改操作来实现。有时您需要对多个相关文件完成一系列相互关联的更改。例如，当数据库应用程序将数据从一个文件传输到另一个文件时，它必须从源文件中删除该数据并在目标文件中创建它。因此，第一次删除和后续创建之间不应该有任何快照。否则快照毫无价值。必须在删除之前或创建之后。作者有责任加强这种语义一致性。每个写入器都是特定于应用程序的，并且在提供程序开始创建快照之前需要  60  秒的时间来建立备份安全状态。如果卷影复制服务在此期间没有收到相应写入器的成功确认，则操作失败。默认情况下，快照是临时的。它无法在重新启动后幸存。自  Windows Server 2003 以来，添加了创建持久快照的功能。但是，Windows 8 删除了浏览快照所需的 GUI 部分。 （§  历史） 支持 VSS 的 Windows 软件和服务包括 Windows 故障转移群集、Windows Server  Backup、Hyper-V、虚拟服务器、Active Directory、SQL Server、Exchange Server 和  SharePoint。最终结果类似于版本化文件系统，使每个文件与创建快照时的状态完全相同。然而，与真正的版本化文件系统不同，用户无法触发单个文件新版本的创建，只能触发整个卷的创建。副作用是，文件所有者可以在版本控制文件系统中创建新版本，但只有系统管理员或备份操作员可以创建新快照（或控制何时拍摄新快照）。这是因为我需要控制文件的管理。整个卷而不是单个文件。此外，许多版本化文件系统（例如  VMS）会在文件发生更改时隐式存储文件版本。使用快照技术的系统（例如 Windows）仅定期捕获状态。
