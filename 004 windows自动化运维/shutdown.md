# shutdown

让你一次关闭或重启一台本地或远程计算机。

## 语法

```
shutdown [/i | /l | /s | /sg | /r | /g | /a | /p | /h | /e | /o] [/hybrid] [/soft] [/fw] [/f] [/m \\computer][/t xxx][/d [p|u:]xx:yy [/c "comment"]]
```

### 参数

|参数|说明|
| ---------| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|/i|显示“远程关机”框。 /i 选项必须是跟在命令后面的第一个参数。 如果指定了 /i，则忽略所有其他选项。|
|/l|立即注销当前用户，没有超时期限。 不能将 /l 与 /m 或 /t 一起使用。|
|/s|关闭计算机。|
|/sg|关闭计算机。 如果启用了“自动重启登录”，在下次启动时，设备会自动登录，并锁定到最后一个交互用户。 登录后，它会重启所有已注册的应用程序。|
|/r|在关机后重启计算机。|
|/g|完全关闭并重启计算机。 如果启用了“自动重启登录”，则在重启时，设备会自动登录，并锁定到最后一个交互用户。登录后，它会重启所有已注册的应用程序。|
|/a|中止系统关机。 只能在超时期间使用。 与 /fw 结合使用，清除固件上任何挂起的启动。|
|/p|仅关闭本地计算机（而不是远程计算机），没有超时期限或警告。 只能将 /p 与 /d 或 /f 一起使用。 如果计算机不支持关闭电源功能，当使用 /p 时，它会关机，但计算机的电源将保持打开状态。|
|/h|如果启用了休眠，则使本地计算机进入休眠状态。 /f 开关可与 /h 开关一起使用。|
|/hybrid|关闭设备并为快速启动做好准备。 此选项必须与 /s 选项一起使用。|
|/soft|允许运行的进程和应用程序正常关闭，而不是强行终止。|
|/fw|将此选项与一个 shutdow 选项结合使用，会导致下一次重启转到固件用户界面。|
|/e|使你能够在[关闭事件跟踪程序](https://learn.microsoft.com/zh-cn/troubleshoot/windows-server/application-management/description-shutdown-event-tracker)中记录计算机意外关闭的原因。|
|/o|转到“高级启动选项”菜单并重启设备。 此选项必须与 /r 选项一起使用。|
|/f|强制正在运行的应用程序关闭，且不向用户发出警告。<br />注意：使用 /f 选项可能会导致丢失未保存的数据。|
|/m`\\<computername>`​|指定目标计算机。 不能与 /l 选项一起使用。|
|/t`<xxx>`​|将关机之前的超时期限设置为 xxx 秒。 有效范围为 0-315360000（10 年），默认值为 30。 如果超时期限大于 0，则 /f 参数是隐式的。|
|/d`[p \| u:]<xx>:<yy>`​|列出系统重启或关机的原因。 支持的参数值为：<br />* P - 指示已计划重启或关机。* U - 指示原因是用户定义的。<br />如果未指定 p 或 u，则重启或关机是计划外的。<br />* xx - 指定主要原因数（小于 256 的正整数）。* yy - 指定次要原因数（小于 65536 的正整数）。|
|/c`<comment>`​|使你能够创建系统关机或重启的自定义原因，必须用双引号括起来。 最多可使用 512 个字符。 还可以与 /d 参数一起使用。|
|/?|在命令提示符下显示帮助，包括本地计算机上定义的主要原因和次要原因的列表。|

#### 注解

* 必须向用户分配“关闭系统”用户权限，才能关闭使用 shutdown 命令的本地或远程管理的计算机。
* 用户必须是 Administrators 组的成员才能对本地或远程管理的计算机的意外关闭添加注释。 如果目标计算机已加入域，则 Domain Admins 组的成员也许能够执行此过程。 有关详细信息，请参阅：

  * [默认本地组](https://learn.microsoft.com/zh-cn/previous-versions/windows/it-pro/windows-server-2003/cc785098(v=ws.10))
  * [默认组](https://learn.microsoft.com/zh-cn/previous-versions/windows/it-pro/windows-server-2003/cc756898(v=ws.10))
* 如果要一次关闭多台计算机，可以使用脚本为每台计算机调用 shutdown，也可以使用 shutdown/i 显示“远程关机”框。
* 如果要指定主要原因代码和次要原因代码，则必须先在计划使用原因的每台计算机上定义这些原因代码。 如果未在目标计算机上定义原因代码，则关闭事件跟踪程序无法记录正确的原因文本。
* 请记得使用 /p 参数指示关机是计划内的。 不使用 /p 参数表示关机是计划外的。

  * 使用 /p 参数以及计划外关机的原因代码会导致关机失败。
  * 不使用 /p 参数而仅提供计划关机的原因代码也会导致关机失败。

关机或重启原因使用以下图例：

* **E**：预期内 - 计划内并提前传达的预期关机或重启。
* **U**：意外 - 系统因错误（例如系统崩溃、电源故障或其他）而停止工作时发生的意外关机或重启。
* **P**：计划内 - 提前安排的计划内关机或重启，例如系统维护、软件安装或其他。
* **C**：客户定义 - 指定系统关机或重启的自定义原因。

|原因类型|主要|次要|说明|
| ----------| ------| ------| ------------------------------|
|U|0|0|其他（计划外）|
|E|0|0|其他（计划外）|
|E 或 P|0|0|其他（计划内）|
|U|0|5|其他故障：系统无响应|
|E|1|1|硬件：维护（计划外）|
|E 或 P|1|1|硬件：维护（计划内）|
|E|1|2|硬件：安装（计划外）|
|E 或 P|1|2|硬件：安装（计划内）|
|E|2|2|操作系统：恢复（计划外）|
|E 或 P|2|2|操作系统：恢复（计划内）|
|P|2|3|操作系统：升级（计划内）|
|E|2|4|操作系统：重新配置（计划外）|
|E 或 P|2|4|操作系统：重新配置（计划内）|
|P|2|16|操作系统：服务包（计划内）|
||2|17|操作系统：热修复（计划外）|
|P|2|17|操作系统：热修复（计划内）|
||2|18|操作系统：安全修复（计划外）|
|P|2|18|操作系统：安全修复（计划内）|
|E|4|1|应用程序：维护（计划外）|
|E 或 P|4|1|应用程序：维护（计划内）|
|E 或 P|4|2|应用程序：安装（计划内）|
|E|4|5|应用程序：无响应|
|E|4|6|应用程序：不稳定|
|U|5|15|系统故障：停止错误|
|U|5|19|安全问题（计划外）|
|E|5|19|安全问题（计划外）|
|E 或 P|5|19|安全问题（计划内）|
|E|5|20|网络连接丢失（计划外）|
|U|6|11|电源故障：电源线被拔出|
|U|6|12|电源故障：环境|
|P|7|0|旧版 API 关闭|

## 示例

若要强制应用在一分钟延迟后关闭并重启本地计算机，并且原因为“Application: Maintenance (Planned)”，注释为“Reconfiguring myapp.exe”，请键入：

```
shutdown /r /t 60 /c "Reconfiguring myapp.exe" /f /d p:4:1
```

若要使用与上一个示例相同的参数重启远程计算机 myemoteserver，请键入：

```
shutdown /r /m \\myremoteserver /t 60 /c "Reconfiguring myapp.exe" /f /d p:4:1
```

要在 5 分钟内因安全更新而重启远程计算机 *myremoteserver* 并在关机事件跟踪器中加入自定义原因，请键入：

```
shutdown /r /t 300 /e /c "Security Update" /m \\myremoteserver
```
