
#network

## TCP 的特性

-   TCP 提供一种**面向连接的、可靠的**字节流服务
-   在一个 TCP 连接中，仅有两方进行彼此通信。广播和多播不能用于 TCP
-   TCP 使用校验和，确认和重传机制来保证可靠传输
-   TCP 给数据分节进行排序，并使用累积确认保证数据的顺序不变和非重复
-   TCP 使用滑动窗口机制来实现流量控制，通过动态改变窗口的大小进行拥塞控制

**注意**：TCP 并不能保证数据一定会被对方接收到，因为这是不可能的。TCP 能够做到的是，如果有可能，就把数据递送到接收方，否则就（通过放弃重传并且中断连接这一手段）通知用户。因此准确说 TCP 也不是 100% 可靠的协议，它所能提供的是数据的可靠递送或故障的可靠通知。


## 三次握手与四次挥手

所谓三次握手(Three-way Handshake)，是指建立一个 TCP 连接时，需要客户端和服务器总共发送3个包。

三次握手的目的是连接服务器指定端口，建立 TCP 连接，并同步连接双方的序列号和确认号，交换 TCP 窗口大小信息。在 socket 编程中，客户端执行 `connect()` 时。将触发三次握手。

-   第一次握手(SYN=1, seq=x):
    
    客户端发送一个 TCP 的 SYN 标志位置1的包，指明客户端打算连接的服务器的端口，以及初始序号 X,保存在包头的序列号(Sequence Number)字段里。
    发送完毕后，客户端进入 `SYN_SEND` 状态。
    
-   第二次握手(SYN=1, ACK=1, seq=y, ACKnum=x+1):
    
    服务器发回确认包(ACK)应答。即 SYN 标志位和 ACK 标志位均为1。服务器端选择自己 ISN 序列号，放到 Seq 域里，同时将确认序号(Acknowledgement Number)设置为客户的 ISN 加1，即X+1。 发送完毕后，服务器端进入 `SYN_RCVD` 状态。
    
-   第三次握手(ACK=1，ACKnum=y+1)
    
    客户端再次发送确认包(ACK)，SYN 标志位为0，ACK 标志位为1，并且把服务器发来 ACK 的序号字段+1，放在确定字段中发送给对方，并且在数据段放写ISN的+1
    发送完毕后，客户端进入 `ESTABLISHED` 状态，当服务器端接收到这个包时，也进入 `ESTABLISHED` 状态，TCP 握手结束。


三次握手的过程的示意图如下：




## TCP/IP四层模型

TCP/IP协议族是一个四层协议系统，自低而上分别是数据链路层、网络层、传输层、应用层。

| **层次名称**   | **单位**  | **功 能**    | **协 议**   |
| -------------- | ----------------- | ----------------- | -------------- |
| **数据链路层**    | 帧   | 负责实际数据的传输，对应OSI参考模型的下两层        | HDLC（高级链路控制协议） |
|      |     |          |     PPP（点对点协议）   |
|      |     |          |     SLIP（串行线路接口协议）  |
| **网络层**            | 数据报 | 负责网络间的寻址数据传输，对应OSI参考模型的第三层     | IP（网际协议）       |
|      |     |         |   ICMP（网际控制消息协议 ）      |
|      |     |         |     ARP（地址解析协议）        |
|      |     |        |      RARP（反向地址解析协议）   |
| **传输层**            | 报文段 | 负责提供可靠的传输服务，对应OSI参考模型的第四层      | TCP（控制传输协议）    |
|      |     |       |   UDP（用户数据报协议）  |
| **应用层**            |     | 负责实现一切与应用程序相关的功能，对应OSI参考模型的上三层 | FTP（文件传输协议）    |
|      |     |         |   HTTP（超文本传输协议）   |
|      |     |        |    DNS（域名服务器协议）    |
|      |     |        |    SMTP（简单邮件传输协议）   |
|      |     |        |   NFS（网络文件系统协议）  |



## OSI七层模型

OSI开放式系统互联通信参考模型（Open System Interconnection Reference Model），简称为**OSI模型**（OSI model），一种概念模型，由国际标准化组织(International Organization for Standardization,ISO)提出，一个试图使各种计算机在世界范围内互连为网络的标准框架，把网络分为七层。

|  **分层**  |  **功能**     |
| ------ | -------------- |
| 应用层    | 网络服务与最终用户的一个接口   |
| 表示层    | 数据格式转换编码，数据压缩和解压，数据加密和解密等     |
| 会话层    | 允许不同主机上的用户之间，建立、管理、终止会话       |
| 传输层    | 把上层数据分割成数据段，定义协议端口号，实现不同主机用户进程间的数据通信 |
| 网络层    | 把上层数据封装成数据包，进行逻辑地址寻址，实现不同网络间的路径选择    |
| 数据链路层  | 把上层数据封装成固定格式的帧，进行硬件地址寻址，差错校验等        |
| 物理层    | 物理连接，完成相邻节点之间的原始比特流的传输       |

![](assets/TCP%20概念/image-20221127211835355.png)

相同点：
- OSI 参考模型与 TCP/IP 参考模型都采用了层次结构
- 都能够提供面向连接和无连接两种通信服务机制

不同点：
- OSI 采用的七层模型； TCP/IP 是四层或五层结构
- TCP/IP 参考模型没有对网络接口层进行细分，只是一些概念性的描述； OSI 参考模型对服务和协议做了明确的区分
- OSI 参考模型虽然网络划分为七层，但实现起来较困难。TCP/IP 参考模型作为一种简化的分层结构是可以的
- TCP/IP协议去掉表示层和会话层的原因在于会话层、表示层、应用层都是在应用程序内部实现的，最终产出的是一个应用数据包，而应用程序之间是几乎无法实现代码的抽象共享的，这也就造成`OSI`设想中的应用程序维度的分层是无法实现的





