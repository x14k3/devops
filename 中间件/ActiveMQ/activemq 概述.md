#middleware/activemq 

**在了解中间件之前，我们先了解一下什么是同步？**

首先我们想一下，两个公司之间如果有互相调用接口的业务需求，如果没有引入中间件技术，是怎么实现的呢？

![](assets/activemq%20概述/image-20221127213149849.png)

用户发起请求给系统A，系统A接到请求直接调用系统B，系统B返回结果后，系统A才能返回结果给用户，这种模式就是同步调用。

所谓同步调用就是各个系统之间互相依赖，一个系统发送请求，其他系统也会跟着依次进行处理，只有所有系统处理完成后对于用户来讲才算完成了一次请求。只要其他系统出现故障，就会报错给用户。

**那么引入中间件后，是如何做到异步调用的呢？**

![](assets/activemq%20概述/image-20221127213156799.png)

用户发起请求给系统A，此时系统A发送消息给MQ，然后就返回结果给用户，不去管系统B了。然后系统B根据自己的情况，去MQ中获取消息，获取到消息的时候可能已经过了1分钟甚至1小时，再根据消息的指示执行相应的操作。

那么想一想，系统A和系统B互相之间是否有通信？这种调用方式是同步调用吗？

系统A发送消息给中间件后，自己的工作已经完成了，不用再去管系统B什么时候完成操作。而系统B拉去消息后，执行自己的操作也不用告诉系统A执行结果，所以整个的通信过程是异步调用的。

说到这里，我们可以做个总结，消息中间件到底是什么呢？

其实消息中间件就是一个独立部署的系统。可以实现各个系统之间的异步调用。当然它的作用可不止这些，通过它可以解决大量的技术痛点，我们接下来会进行介绍。

消息中间件，总结起来作用有三个：**异步化提升性能、降低耦合度、流量削峰。**


## Queue和Topic消息模式

| 比较项目| Topic模式队列 | Queue模式队列 |
| --------- | ----------------| -------------------|
| 工作模式 | 订阅-发布_模式； 如果当前没有订阅者，消息将会别丢弃； 如果有多个订阅者，那么所有订阅者都会受到消息 | 负载均衡模式，如果当前没有消费者，消息也不会丢弃。如果有多个消费者，那么一条消息也只会发送给一个消费者，并且要求消费者ack信息 |
| 有无状态 | 无状态 | Queue数据默认会在MQ服务器上以文件的形式保存，ActiveMQ一般会保存在$AMQ_HOME/data/kahadb下面，也可以配置成DB存储。|
| 传递完整性 | 如果没有订阅者，消息会被丢弃。 | 消息不会被丢弃。|
| 处理效率 | 由于消息要按照订阅者的数量进行复制，所有处理性能会随着订阅者的增加而明显降低，并且还要结合不同消息协议自身的性能差异。| 由于一条消息只发送给一个消费者，所以就算消费者再多，性能也不会有明显降低，当然不同消息协议的具体性能也是有差异的。|