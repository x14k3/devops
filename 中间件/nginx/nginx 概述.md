#middleware/nginx

由C语言开发，是一个高性能的 HTTP 和反向代理服务器，也是一个 IMAP/POP3/SMTP 代理服务器。Nginx 相较于 Apache 具有占有内存少，稳定性高等优势，并且依靠并发能力强，丰富的模块库以及友好灵活的配置而闻名。


[[nginx 部署]]
[[nginx 功能配置说明]]
[[nginx 安全及优化]]

# nginx工作原理

**nginx 的进程模型选择的是多进程+异步非阻塞（epoll）**

```bash
为了响应客户端或者对端服务器的请求，服务器一般需要拥有并行或者并发能力，即同时或者同时段可以响应客户端的请求，一般的做法有：
1. 多进程 缺点是进程数量过多的时候，内存等系统资源开销过大，可能会导致系统奔溃
2. 多线程 缺点是线程间共享内存，得考虑线程安全的问题，还得考虑锁的问题
```

```bash
#####################**同步与与异步**####################
同步与异步的重点在消息通知的方式上，也就是调用结果的通知方式不同。
- 同步：当一个同步调用发出去后，调用者要一直等待调用的结果通知后，才能进行后续的执行。
- 异步：当一个异步调用发出去后，调用者不必一直等待调用结果的返回。

异步调用，要想获得结果， 一般有两种方式：
1.主动轮询异步调用的结果;
2.被调用方通过 callback（回调通知）来通知调用方调用结果。

####################**阻塞与非阻塞**######################

阻塞与非阻塞的重点在于进/线程等待消息时候的行为，也就是在等待消息的时候，当前进/线程是挂起状态，还是非挂起状态。
- 阻塞：调用在发出去后，消息返回之前，当前进/线程会被挂起，直到有消息返回，当前进/线程才会被激活 。
- 非阻塞：调用在发出去后，不会阻塞当前进/线程，而会立即返回
--------------------------------------------------------
#####   **Linux内核模块epoll实现了异步非阻塞    #####**
```

![](assets/nginx%20概述/image-20221127213523976.png)



## 工作模式

**master-worker模式**

> nginx启动成功后，会有一个master进程和至少一个的worker进程。master进程负责处理系统信号，加载配置，管理worker进程（启动，杀死，监控，发送消息/信号等）。worker进程负责处理具体的业务逻辑，也就是说，对外部来说，真正提供服务的是worker进程。生产环境下一般使用这种模式。

优点：

1.稳定性高，只要还有worker进程存活，就能够提供服务，并且一个worker进程挂掉master进程会立即启动一个新的worker进程，保证worker进程数量不变，降低服务中断的概率。
2.配合linux的cpu亲和性配置，可以充分利用多核cpu的优势，提升性能
4.处理信号/配置重新加载/升级时可以做到尽可能少或者不中断服务

![](assets/nginx%20概述/image-20221127213530439.png)



**单进程模式**

> nginx启动后只有一个进程，nginx的所有工作都由这个进程负责。因此，该模式一般只在开发阶段和调试时使用，生产环境下不会使用。

优点：单进程模式由于只有一个进程，因此可以很方便地利用gdb等工具进行调试。

缺点：单进程模式不支持nginx的平滑升级功能，任何的信号处理都可能造成服务中断，并且由于是单进程，进程挂掉后，在没有外部监控的情况下，无法重启服务
