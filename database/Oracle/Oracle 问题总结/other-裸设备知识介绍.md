#oracle

裸设备，也叫裸分区（原始分区），是一种没有经过格式化，不被Unix通过文件系统来读取的特殊字符设备。本文收集裸设备和Oracle问答20例。

**1．什么叫做裸设备？**

> 裸设备，也叫裸分区（原始分区），是一种没有经过格式化，不被Unix通过文件系统来读取的特殊字符设备。它由应用程序负责对它进行读写操作。不经过文件系统的缓冲。

**2．如何辨别裸设备？**

> 在Unix的/dev 目录下，有许多文件，其中有两个大类：字符设备文件和块设备文件。
>
> 字符设备特殊文件进行I/O操作不经过操作系统的缓冲区，而块设备特殊文件用来同外设进行定长的包传输。字符特殊文件与外设进行I/o操作时每次只传输一个字符。而对于块设备特殊文件来说，它用了cache机制，在外设和内存之间一次可以传送一整块数据。裸设备使用字符特殊文件。在/dev 目录下，你可以看到许多这样的文件。

**3．使用裸设备的好处**

> 因为使用裸设备避免了再经过Unix操作系统这一层，数据直接从Disk到Oracle进行传输，所以使用裸设备对于读写频繁的数据库应用来说，可以极大地提高数据库系统的性能。当然，这是以磁盘的 I/O 非常大，磁盘I/O已经称为系统瓶颈的情况下才成立。如果磁盘读写确实非常频繁，以至于磁盘读写成为系统瓶颈的情况成立，那么采用裸设备确实可以大大提高性能，最大甚至可以提高至40％，非常明显。
>
> 而且，由于使用的是原始分区，没有采用文件系统的管理方式，对于Unix维护文件系统的开销也都没有了，比如不用再维护I-node，空闲块等，这也能够导致性能的提高。

**4．如何决定是否应该使用裸设备？**

> 判断是否使用裸设备要从以下方面进行考虑：首先，数据库系统本身需要已经被比较好的经过了优化。优化是一门很有些技术的话题，很难简单地讲述。其次，使用Unix命令来辨别是否存在磁盘读写瓶颈。比如Unix的vmstat, sar 等命令都可以较好的进行鉴别。如果决定采用裸设备，需要磁盘上还有空闲的分区。否则，就要新添磁盘，或者对原有系统重新规划。

**5．什么系统必须使用裸设备？**

> 如果使用了Oracle 并行服务器选项，则必须采用裸设备来存放所有的数据文件，控制文件，重做日志文件。只有把这些文件放到裸设备上，才能保证所有Oracle 实例都可以读取这个数据库的文件。这是由Unix操作系统的特性决定的。
>
> 还有一种情况是，如果你想使用异步I/O，那么在有些Unix上也必须采用裸设备。这个需要参考具体Unix的相关文档。

**6．能够使用一个磁盘的第一个分区作为裸设备吗？**

> 可以，但是不推荐。在Unix的比较旧的版本是银行，磁盘的第一个分区常常包含这个磁盘的一些信息，以及逻辑卷的一些控制信息。若这些部分被裸设备覆盖的话，磁盘就会变得不可识别，导致系统崩溃。
>
> 较新的Unix版本不会发生这样的情况，因为它们采用了更复杂的技术来管理磁盘，逻辑卷的一些信息。
>
> 但是，除非很确信不要使用磁盘的第一个分区来作为裸设备。

**7．我可以把整个裸设备都作为Oracle的数据文件吗？**

> 不行。必须让数据文件的大小稍微小于该裸设备的实际大小。至少要空出两个oracle块的大小来。

**8．裸设备应该属于那个用户？**

> 应该由root来创建裸设备，然后再分配给Oracle用户以供使用。同时还要把它归入Oracle用户所在的那个组里边（通常都是DBA）。

**9．在创建数据文件时如何指定裸设备？**

> 和普通文件没有什么太大的区别，一样都是在单引号里边写上裸设备的详细路径就可以了。举一个例子：要在创建一个表空间，使用两个裸设备，每个分别为30M的大小，Oracle块的大小为4K，可以用下面的命令：  
> 　　CREATE TABLESPACE RAW_TS  
> 　　DATAFILE '/dev/raw1' size 30712k  
> 　　DATAFILE '/dev/raw2' size 30712k;

**10.Oracle块的大小和裸设备有什么关系吗？**

> Oracle会必须是裸设备上物理块大小的倍数。

**11．如何在裸设备上进行备份？**

> 在裸设备上，不能使用Unix实用程序来进行备份，唯一的办法是使用最基本的Unix命令：DD来进行备份。比如：dd if=/dev/raw1 of=/dev/rmt0 bs=16k。dd的具体语法可以参考unix手册，或者联机帮助。你也可以先用dd把裸设备上的数据文件备份到磁盘上，然后再利用Unix实用程序进一步处理。

**12．如果我没有使用Oracle并行服务器选项，我可以在数据库上让一部分数据文件使用文件系统，另一部分使用裸设备吗？**

> 可以。但是这样的话，会使备份过程更加复杂。

**13．我应该把联机重做日志文件放到裸设备上吗？**

> 这是一个极好的选择。联机重做日志文件是写操作非常频繁的文件，放到裸设备上非常合适。如果你使用了并行服务器选项，那么联机重做日志文件必须放到裸设备上面。

**14．可以把归档日志文件放到裸设备上吗？**

> 不行。归档日志文件必须放到常规的Unix文件系统上面，或者直接放到磁带上面去。

**15．我可以在裸设备上边放置多个数据文件吗？**

> 不行。所以你必须在设置裸设备时非常小心。太小的话，会导致空间很快用完，太大的话，空间就白白浪费了。

**16．因应该把几个裸设备放到同一个物理磁盘上吗？**

> 这样做不好。因为使用裸设备就是为了提高磁盘读写速度。而把多个裸设备放到同一个物理磁盘上会导致读写竞争，这样对于提高I/O速度是不利的。应该尽量分散裸设备到不同的物理磁盘上，最好是分散到不同的磁盘控制器上。这是最佳选择。

**17．需要把所有裸设备都定义成同样的大小吗？**

> 这不是必须得，但是划分成同样的大小对于管理数据库比较有利。

**18．为了在Unix上使用裸设备，我需要改变Unix核心参数吗？**

> 不需要。但可以选择减小缓冲区的大小，如果没有别的应用也在同一台Unix机器上运行。因为运用了裸设备以后，不再使用Unix的系统缓冲区。

**19．为了提高读写速度，在操作系统级别上，还有什么办法可以采取吗？**

> 使用RAID（廉价冗余磁盘阵列）也是非常有效的办法，尤其实那种读写非常频繁的系统。

**20．在考虑了以上所有方面后，还能有什么办法可以提高性能的吗？**

> 这就需要对Oracle 进行优化，并且购买更多的磁盘和磁盘控制器，来分散I/O到不同的磁盘上。
