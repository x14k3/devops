
iPerf3是用于主动测量IP网络上最大可达到带宽的工具。它支持与时序，缓冲区和协议（TCP，UDP，带有IPv4和IPv6的SCTP）相关的各种参数的调整。对于每个测试，它都会报告带宽，损耗和其他参数。y

‍

```bash
# 服务端（流量接收端）
iperf3 -s -p 5201 -D

# 客户端（流量发送端）
iperf3 -c 10.8.0.1 -p 5201 -f M -t 60  -Z --logfile /tmp/perf3_client.log

# 例一：执行20s，每5s执行一次
iperf3 -c 43.248.136.69 -t 20 -i 5

# 传输数据包5G，每7s显示一次
iperf3 -c 43.248.136.69 -i 7 -n 5G

# -F指定文件传输
iperf3 -c 43.248.136.69 -i 2 -F Python-3.7.1rc2.tgz -t 20

```

## 命令说明

### 通用参数

| 命令行参数                  | 描述说明                                                                                                                     |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| -p, --port n           | 1、服务端：服务端监听的端口，默认5201端口，同时监听TCP/UDP<br />2、客户端：客户端去连接的端口，默认5201，如果同时有-u参数，则用UDP发起连接，如果没有，则默认使用TCP连接                      |
| --cport n              | 本参数提供了一个指定客户端本地端口的选项，区分于-p指定的是服务端的远端端口                                                                                   |
| -f, --format [kmKM]    | 指定打印测试结果的带宽（bitrate比特率这一列）时用什么格式显示:k表示：千比特/秒， K表示：千字节/秒， m表示：兆比特/秒， K表示：兆字节/秒。<br />客户端和服务端可以用不同的参数，各自按照各自指定的方式打印出带宽测试结果 |
| -i, --interval n       | 以秒为单位，设置带宽（还有抖动，丢包等）测试报告打印输出的周期。不使用这个选项时，默认周期是1秒，可以使用0和任何0.1秒到60秒之间的参数，如果是0表示不打印周期性的报告，只在整个测试完成时，输出一次报告结果。               |
| -F, --file name        | 客户端：从文件中读取数据，并发送到网络里，如果不加这个选项默认系统会产生随机数据发送到网络里<br />服务端：把网络上收到的数据写入文件中，默认系统会丢弃收到的数据                                      |
| -A, --affinity n/n,m-F | 如果系统支持则可以设置CPU亲和性（只支持Linux和FreeBSD），说白了就是在设定将iperf3进程跑在哪个CPU上。                                                           |
| -B, --bind host        | 绑定到主机，主机的一个地址。对客户端来说，这个设置数据发送从哪个接口发送。                                                                                    |
| -V, --verbose          | 输入更多的详细信息                                                                                                                |
| -J, --json             | 运行结束时，用JSON的格式输出测试结果，默认打印到屏幕上，可以结合下面"--logfile"或者linux本身的重定向命令">"将输出报告打印到指定文件里                                           |
| --logfile file         | 把测试结果存到指定的log文件                                                                                                          |
| -d, --debug            | 打印出更多的调试用的log，主要是给开发者用的，如果不是碰到需要调试的问题，这个参数基本没什么用。                                                                        |
| -v, --version          | 只要加了-v这个参数，iperf3会显示版本号，然后自动退出                                                                                           |
| -h, --help             | 只要加了-h这个参数，iperf3会显示帮助信息(包括命令使用格式，各个参数的简明的使用说明)，然后自动退出-Z                                                                 |

### 服务器端专用参数

| 命令行参数             | 具体描述<br />                                                                                         |
| ----------------- | -------------------------------------------------------------------------------------------------- |
| -s, --server      | 本次iperf3运行在服务端模式（-c和-s是互斥的，二者必居其一），括号里的这句话：这只允许一次一个iperf connection，是指iperf服务端同一时间只接受一个TCP或者UDP连接。 |
| -D, --daemon      | 以daemon的形式在后台运行(不会向控制台窗口输出，可以通过ps -aux 竖符号 grep iperf3看到对应的后台进程号)                                  |
| -I, --pidfilefile | 这介需要iperf3.1以上版本才支持，提供了一个将本次运行的iperf3进程的PID写入到指定文件里的功能，正常的情况下也没啥用，大概率在将程序运行成Daemon程序               |

### 客户端专用参数

| 命令行参数                       | 具体描述                                                                                                |
| --------------------------- | --------------------------------------------------------------------------------------------------- |
| -c, --client host           | 本次iperf3运行在客户端状态，host指向的是iperf服务端的ip地址                                                              |
| --sctp                      | 使用sctp协议（不加这人选项的话默认使用tcp），iperf3.1及更新的版本开始支持                                                        |
| -u, --udp                   | 使用udp协议（不加这人选项的话默认使用tcp），使用这个选项的话，还需要查看-b选项，因为UDP是面向数据报的协议，所以一般要用-b指定打多大带宽的数据(不指定-b的话，默认值见对-b参数的解释) |
| -b, --bandwidth n[KM]       | 设置带宽                                                                                                |
| -t, --time n                | 设置测试时间                                                                                              |
| -n, --num n[KM]             | 定义本次发送报文要发送的总的数据长度，单位是字节。默认情况下iperf持续发送10秒时间。                                                       |
| -k, --blockcount n[KM]      | 定义本次发送报文要发送的报文个数。发送-k指定个数的报文,发送完后停止。                                                                |
| -l, --length n[KM]          | 每次发报的报文长度。                                                                                          |
| -P, --parallel n            | 到iperf3服务器端并行的连接数量，默认值是1。                                                                           |
| -R, --reverse               | 工作在反向连接模式（服务器端发送，客户端接收）                                                                             |
| -w, --window n[KM]          | 设置socket缓冲的大小。对TCP来说，这个用于设置 TCP 窗口接收的大小（这个选项会被发送到服务器端，同样的参数会在服务器端生效）                                |
| -M, --set-mss n             | 尝试去设置TCP的MSS最大分片长度。MSS通常是MTU减去40字节的TCP/IP首部。对以达网来说MSS是1460（MTU是1500字节）                              |
| -N, --no-delay              | 设置TCP的不延时选项，关闭Nagle's算法，                                                                            |
| -4, --version4              | 只使用IPv4                                                                                             |
| -6, --version4              | 只使用IPv6, 注意这个要配合IPv6的地址一起使用                                                                         |
| -S, --tos n                 | 设置被发送出去的报文的TOS字段。                                                                                   |
| -L, --flowlabel n           | 设置IPv6的流标签（目前只有Linux版本的iperf3能支持）                                                                   |
| -Z, --zerocopy              | 使用“零拷贝”办法来发送数据，比如使用sendfile(2)代替write(2).这会减少CPU的占用率                                                |
| -O, --omit n                | 忽略最前面n秒的测试结果，通常用来跳过TCP慢启动过程                                                                         |
| -T, --title str             | 每行打印输出内容前加一个前缀                                                                                      |
| -C, --linux-congestion algo | 设置TCP拥塞控制算法(在LINUX上3.0以上支持，在LINUX和FREEBSD上3.1以下版本支持)                                                |
